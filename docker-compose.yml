version: '3.8'

services:
  subseek:
    image: ghcr.io/${IMAGE_OWNER:-twj0}/subseek:latest
    container_name: subseek
    environment:
      # API Keys
      - GH_TOKEN=${GH_TOKEN}
      - HUNTER_API_KEY=${HUNTER_API_KEY}
      - QUAKE_API_KEY=${QUAKE_API_KEY}
      # GitHub Speed Settings
      - GH_SEARCH_TERMS=${GH_SEARCH_TERMS:-free v2ray,free proxy}
      - MAX_GH_KW=${MAX_GH_KW:-2}
      - GH_PER_PAGE=${GH_PER_PAGE:-30}
      - GH_SLEEP_INTERVAL=${GH_SLEEP_INTERVAL:-2}
      - GH_REQUEST_TIMEOUT=${GH_REQUEST_TIMEOUT:-10}
      # Run Control
      - RUN_GITHUB=${RUN_GITHUB:-1}
      - RUN_PLATFORMS=${RUN_PLATFORMS:-1}
      - MAX_WORKERS=${MAX_WORKERS:-8}

    volumes:
      - ./data:/app/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "test", "-f", "/app/data/nodes.db"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
